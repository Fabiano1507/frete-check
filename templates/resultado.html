<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Resultado - Valida Frete</title>
    <style>
        body { font-family: Arial; background:#f4f6f8; }
        .container { max-width:1200px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th, td { border:1px solid #ddd; padding:8px; text-align:center; }
        th { background:#003366; color:white; }
        .ok { color:green; font-weight:bold; }
        .maior { color:red; font-weight:bold; }
        .menor { color:orange; font-weight:bold; }
        .btn { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; }
        .btn-primary { background:#003366; color:white; }
        .btn-secondary { background:#666; color:white; }
        details { margin-top:5px; text-align:left; }
        img { height:60px; }
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; align-items:center; justify-content:space-between;">
        <img src="{{ url_for('static', filename='Logo2.jfif') }}">
        <h2>Resultado da Validação de Frete</h2>
    </div>

    <table>
        <tr>
            <th>CT-e</th>
            <th>Origem</th>
            <th>Destino</th>
            <th>Valor Tabela</th>
            <th>Valor Cobrado</th>
            <th>Diferença</th>
            <th>Status</th>
        </tr>

        {% for r in resultados %}
        <tr>
            <td>{{ r.cte }}</td>
            <td>{{ r.origem }}</td>
            <td>{{ r.destino }}</td>
            <td>R$ {{ "%.2f"|format(r.valor_tabela) }}</td>
            <td>R$ {{ "%.2f"|format(r.valor_cobrado) }}</td>
            <td>R$ {{ "%.2f"|format(r.diferenca) }}</td>
            <td class="{{ r.status|lower }}">{{ r.status }}</td>
        </tr>
        <tr>
            <td colspan="7">
                <details>
                    <summary>Memória de cálculo</summary>
                    Frete m³: R$ {{ "%.2f"|format(r.memoria.frete_m3) }}<br>
                    Frete base: R$ {{ "%.2f"|format(r.memoria.frete_base) }}<br>
                    ADV: R$ {{ "%.2f"|format(r.memoria.adv) }}<br>
                    Taxa: R$ {{ "%.2f"|format(r.memoria.taxa) }}<br>
                    Pedágio: R$ {{ "%.2f"|format(r.memoria.pedagio) }}<br>
                    Divisor ICMS: {{ r.memoria.divisor_icms }}
                </details>
            </td>
        </tr>
        {% endfor %}

        <tr>
            <th colspan="3">Totais</th>
            <th>R$ {{ "%.2f"|format(totais.total_tabela) }}</th>
            <th>R$ {{ "%.2f"|format(totais.total_cobrado) }}</th>
            <th>R$ {{ "%.2f"|format(totais.total_diferenca) }}</th>
            <th></th>
        </tr>
    </table>

    <form method="post" action="/exportar" style="margin-top:20px;">
        <input type="hidden" name="dados" id="dados">
        <button class="btn btn-primary" type="submit">Exportar para Excel</button>
        <a href="/" class="btn btn-secondary">Voltar</a>
    </form>
</div>

</body>
</html>